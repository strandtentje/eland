{
	namefield = f"control.conf@namefield";
	phonefield = f"control.conf@phonefield";
	emailfield = f"control.conf@emailfield";
	optionalfield = f"control.conf@optionalfield";
	showfield = f"view.conf@field";

	personform = <showfield>(name = "firstname") & 
		<showfield>(name = "lastname") & 
		<showfield>(name = "phone") & 
		<showfield>(name = "mailto") & 
		<showfield>(name = "token") & 
		<f"view.conf@validness"> {
			invalidpersonregistration->Template(f"templates/invalidregistrationfooter.html");
			validpersonregistration->Template(f"templates/validregistrationfooter.html");
		};

	personpost = Check() {
		subject->WwwForm(fieldlist = 
			["firstname", "lastname", "phone", "mailto", "token"]
		) {
			firstname-><namefield>(name = "firstname");
			lastname-><namefield>(name = "lastname");
			phone-><phonefield>(name = "phone");
			mailto-><emailfield>(name = "mailto");
			token-><optionalfield>(name = "token");
		};
		failure-><f"control.conf@invalidate">;
		successful-><f"control.conf@validate">;
	};	

	editperson = Template(f"templates/form.html") {
		body->HttpMethod() {
			get->personform;
			post->TextField(variable = "directoryname", pattern = "^self$") {
				successful->personpost;
				failure->personform;
			};
		};
	};

	instances = {
		new = Module(
			f"../perm/ission.conf@usertogroup", 
			groupname = "user"
		) {
			granted->editperson;
		};

		modify = editperson;
	};
}