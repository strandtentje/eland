{
	wiki = <f"wiki/agwiki.conf@begin">(baseurl = "");

	content = Dir() {
		default->wiki;
		register-><f"perm/ission.conf@check">(
			resource = "self", action = "create"
		) {
			denied->Template(f"templates/accessdenied.html");
			granted-><f"login/auth.conf@register">(username = "") {
				authenticated-><f"person/main.conf@new">;
			};
		};
		self-><f"perm/ission.conf@check">(
			resource = "self", action = "modify"
		) {
			denied->Template(f"templates/accessdenied.html");
			granted-><f"person/main.conf@modify">;
		};
		login-><f"perm/ission.conf@check">(
			resource = "session", action = "create"
		) {
			denied->Template(f"templates/accessdenied.html");
			granted-><f"login/auth.conf@identify"> {
				authenticated->Template(f"templates/loggedin.html");
			};
		};
		admin-><f"perm/ission.conf@check">(
			resource = "user", action = "admin"
		) {
			denied->Template(f"templates/accessdenied.html");
			granted-><f"admin.conf@begin">;
		};
	};


	application = Dir() {
		default-><f"skelet.conf@on"> {
			content->content;
		};

		static->Fileserver(f"static");

		score-><f"score/view.conf@begin">;

		aanpassen-><f"score/controller.conf@begin">;

		problems-><f"problems/view.conf@begin">;

		logout-><f"skelet.conf@logout">;
	};
	
	dbcon = "Server=localhost; Database=stortneer; User ID=stortneer; Password=stortneer; Pooling=true; Allow User Variables=True";

	instances = {
		connectors = 
			Connector(name = "stortneer", connectionstring = dbcon) & 
			Connector(name = "agwiki", connectionstring = dbcon) & 
			Connector(name = "aglogin",connectionstring = dbcon) & 
			Connector(name = "agperm",connectionstring = dbcon);

		begin = <f"login/auth.conf@enticate">(
			login = -1, username = "guest"
		) {
			authenticated->application;
			unauthenticated->application;
		};
	};
}
